<<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="GuideViewer.Views.Dialogs.GuideUpdatesDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Guide Updates Available"
    PrimaryButtonText="Import Selected"
    CloseButtonText="Cancel"
    DefaultButton="Primary">

    <ScrollViewer MaxHeight="500">
        <StackPanel Spacing="16">
            <!-- Header Info -->
            <TextBlock
                Text="Select the guides you want to import from OneDrive:"
                TextWrapping="Wrap"
                Style="{StaticResource BodyTextBlockStyle}"/>

            <!-- Select All/None -->
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button
                    x:Name="SelectAllButton"
                    Content="Select All"
                    Click="SelectAllButton_Click"
                    Style="{StaticResource SecondaryButtonStyle}"/>
                <Button
                    x:Name="SelectNoneButton"
                    Content="Select None"
                    Click="SelectNoneButton_Click"
                    Style="{StaticResource SecondaryButtonStyle}"/>
            </StackPanel>

            <!-- Updates List -->
            <ItemsRepeater x:Name="UpdatesRepeater">
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="12"
                            Margin="0,0,0,8">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Checkbox -->
                                <CheckBox
                                    Grid.Column="0"
                                    IsChecked="True"
                                    VerticalAlignment="Center"
                                    Tag="{Binding}"
                                    Checked="UpdateCheckBox_Changed"
                                    Unchecked="UpdateCheckBox_Changed"/>

                                <!-- Guide Info -->
                                <StackPanel Grid.Column="1" Spacing="4">
                                    <TextBlock
                                        Text="{Binding OneDriveGuide.Title}"
                                        Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    <TextBlock
                                        Style="{StaticResource CaptionTextBlockStyle}"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="{Binding OneDriveGuide.FileName}"/>
                                        <Run Text="Â·"/>
                                        <Run Text="{Binding OneDriveGuide.FileSize}"/>
                                        <Run Text="bytes"/>
                                    </TextBlock>
                                    <TextBlock
                                        Style="{StaticResource CaptionTextBlockStyle}"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                                        <Run Text="Last modified:"/>
                                        <Run Text="{Binding OneDriveGuide.LastModified}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Update Badge -->
                                <Border
                                    Grid.Column="2"
                                    Background="{ThemeResource AccentFillColorDefaultBrush}"
                                    CornerRadius="4"
                                    Padding="8,4"
                                    VerticalAlignment="Center">
                                    <TextBlock
                                        Style="{StaticResource CaptionTextBlockStyle}"
                                        Foreground="White"
                                        FontWeight="SemiBold">
                                        <Run x:Name="UpdateTypeRun">
                                            <!-- Bound via code-behind based on UpdateType -->
                                        </Run>
                                    </TextBlock>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>

            <!-- Summary -->
            <Border
                Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}"
                BorderBrush="{ThemeResource SystemFillColorAttentionBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
                <TextBlock
                    x:Name="SummaryTextBlock"
                    TextWrapping="Wrap"
                    Style="{StaticResource CaptionTextBlockStyle}"/>
            </Border>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
